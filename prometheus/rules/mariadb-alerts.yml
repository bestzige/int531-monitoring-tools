groups:
  - name: mariadb-alerts
    rules:
      # MariaDB / Exporter DOWN
      - alert: MariaDBDown
        expr: up{job="mariadb"} == 0
        for: 1m
        labels:
          severity: critical
          service: mariadb
        annotations:
          title: 'ðŸ”´ MariaDB Down'
          runbook: 'runbooks/mariadb.md#down'
          description: 'MariaDB exporter (x-mariadb-exporter:9104) is unreachable'

      # Too many connections
      - alert: MariaDBTooManyConnections
        expr: |
          mysql_global_status_threads_connected
          /
          mysql_global_variables_max_connections
          > 0.8
        for: 3m
        labels:
          severity: warning
          service: mariadb
        annotations:
          title: 'ðŸ”Œ Too Many Connections'
          runbook: 'runbooks/mariadb.md#connections'
          description: 'Connections exceed 80%'

      # Slow queries
      - alert: MariaDBSlowQueries
        expr: rate(mysql_global_status_slow_queries[5m]) > 1
        for: 5m
        labels:
          severity: warning
          service: mariadb
        annotations:
          title: 'ðŸŒ Slow Queries'
          description: 'Slow queries increasing'
          runbook: 'runbooks/mariadb.md#slow'

      # InnoDB buffer pool
      - alert: MariaDBHighBufferPoolUsage
        expr: |
          mysql_global_status_innodb_buffer_pool_bytes_data
          /
          mysql_global_variables_innodb_buffer_pool_size
          > 0.9
        for: 5m
        labels:
          severity: warning
          service: mariadb
        annotations:
          runbook: 'runbooks/mariadb.md#bufferpool'
          title: 'ðŸ§  Buffer Pool Almost Full'
          description: 'InnoDB buffer pool usage > 90%'
