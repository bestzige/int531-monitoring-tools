groups:
  - name: node-alerts
    rules:
      - alert: NodeDown
        expr: up{job=~"node|node_exporter"} == 0
        for: 1m
        labels:
          severity: critical
          service: node
        annotations:
          title: 'üî¥ Node Down'
          description: 'Node {{ $labels.instance }} ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á'
          runbook: 'runbooks/node.md#node-down'

      - alert: NodeHighCPU
        expr: |
          100 - avg by (instance) (
            rate(node_cpu_seconds_total{mode="idle"}[5m]) * 100
          ) > 85
        for: 5m
        labels:
          severity: warning
          service: node
        annotations:
          title: 'üî• High CPU Usage'
          description: 'CPU > 85% on {{ $labels.instance }}'
          runbook: 'runbooks/node.md#cpu'

      - alert: NodeHighLoad
        expr: |
          node_load1
          /
          count by (instance) (node_cpu_seconds_total{mode="system"})
          > 1.5
        for: 5m
        labels:
          severity: warning
          service: node
        annotations:
          title: 'üìà High Load Average'
          description: 'Load ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô CPU core ‡∏ö‡∏ô {{ $labels.instance }}'
          runbook: 'runbooks/node.md#load'

      - alert: NodeMemoryPressure
        expr: |
          (node_memory_MemAvailable_bytes
          / node_memory_MemTotal_bytes) < 0.15
        for: 3m
        labels:
          severity: warning
          service: node
        annotations:
          title: 'üíæ Memory Pressure'
          description: 'Available memory < 15% on {{ $labels.instance }}'
          runbook: 'runbooks/node.md#memory'

      - alert: NodeDiskAlmostFull
        expr: |
          (node_filesystem_avail_bytes
          / node_filesystem_size_bytes) < 0.15
          and node_filesystem_readonly == 0
        for: 5m
        labels:
          severity: critical
          service: node
        annotations:
          title: 'üíΩ Disk Almost Full'
          description: 'Disk < 15% free on {{ $labels.instance }} ({{ $labels.mountpoint }})'
          runbook: 'runbooks/node.md#disk'
